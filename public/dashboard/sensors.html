<!doctype html>
<html lang="pt-br" dir="ltr">
    <head>
        <!--HTML Meta Tags-->
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="author" content="Aerasense" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />

        <!--Favicon-->
        <link
            rel="icon"
            type="image/x-icon"
            href="../assets/icons/favicon.ico"
        />

        <!--Google Fonts-->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet"
        />

        <!--Stylessheet-->
        <link rel="stylesheet" href="../assets/css/sensors.css" />

        <!--Title-->
        <title id="titulo_dash">Sensores</title>
    </head>
    <body>
        <!--Sidebar-->
        <div class="sidebar">
            <div class="">
                <!--Logo-->
                <div class="logo">
                    <?xml version="1.0" encoding="utf-8"?>
                    <svg
                        viewBox="0 0 730 216"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <g>
                            <path
                                d="M30.375 159.841Q23.9062 159.841 18.3516 157.556Q12.832 155.236 9.49219 150.56Q6.1875 145.884 6.1875 138.959Q6.1875 129.185 12.8672 123.209Q19.582 117.232 33.5391 117.232L55.4414 117.232L55.4414 114.209Q55.4414 109.287 53.9297 106.404Q52.418 103.521 48.4453 102.255Q44.5078 100.955 36.8789 100.955Q24.7852 100.955 14.2734 104.541L14.2734 92.8687Q18.8789 91.0055 25.4883 89.8805Q32.0977 88.7203 39.7266 88.7203Q54.7031 88.7203 62.543 94.7672Q70.418 100.814 70.418 114.49L70.418 158.4L57.0234 158.4L56.0039 151.474Q51.8555 155.517 45.7031 157.697Q39.5859 159.841 30.375 159.841ZM34.5586 148.591Q41.625 148.591 46.8633 146.236Q52.1367 143.845 55.4414 139.837L55.4414 127.884L33.8555 127.884Q26.9297 127.884 23.8359 130.556Q20.7422 133.193 20.7422 138.677Q20.7422 143.986 24.3281 146.306Q27.9492 148.591 34.5586 148.591ZM122.397 159.841Q104.538 159.841 94.7289 151.052Q84.9555 142.263 84.9555 124.123Q84.9555 107.705 93.2875 98.2125Q101.655 88.7203 118.67 88.7203Q134.209 88.7203 142.049 96.8414Q149.889 104.962 149.889 117.795L149.889 130.451L99.9321 130.451Q101.092 140.4 107.139 144.162Q113.186 147.888 125.561 147.888Q130.764 147.888 136.213 146.904Q141.698 145.884 145.741 144.302L145.741 155.798Q141.135 157.837 135.159 158.822Q129.182 159.841 122.397 159.841ZM99.9321 120.255L136.073 120.255L136.073 115.474Q136.073 108.443 132.17 104.47Q128.303 100.498 119.092 100.498Q108.159 100.498 104.045 105.279Q99.9321 110.025 99.9321 120.255ZM165.166 158.4L165.166 90.1266L179.58 90.1266L180.424 98.0719Q185.311 94.9078 192.096 92.3062Q198.881 89.7047 205.491 88.7203L205.491 100.673Q201.448 101.377 196.772 102.748Q192.096 104.119 187.912 105.771Q183.729 107.423 180.881 109.146L180.881 158.4L165.166 158.4ZM233.847 159.841Q227.378 159.841 221.824 157.556Q216.304 155.236 212.964 150.56Q209.659 145.884 209.659 138.959Q209.659 129.185 216.339 123.209Q223.054 117.232 237.011 117.232L258.913 117.232L258.913 114.209Q258.913 109.287 257.402 106.404Q255.89 103.521 251.917 102.255Q247.98 100.955 240.351 100.955Q228.257 100.955 217.745 104.541L217.745 92.8687Q222.351 91.0055 228.96 89.8805Q235.57 88.7203 243.199 88.7203Q258.175 88.7203 266.015 94.7672Q273.89 100.814 273.89 114.49L273.89 158.4L260.495 158.4L259.476 151.474Q255.327 155.517 249.175 157.697Q243.058 159.841 233.847 159.841ZM238.031 148.591Q245.097 148.591 250.335 146.236Q255.609 143.845 258.913 139.837L258.913 127.884L237.327 127.884Q230.402 127.884 227.308 130.556Q224.214 133.193 224.214 138.677Q224.214 143.986 227.8 146.306Q231.421 148.591 238.031 148.591ZM314.056 159.841Q307.025 159.841 300.592 158.822Q294.193 157.837 290.01 156.396L290.01 143.142Q294.896 145.005 300.802 146.025Q306.709 147.009 312.052 147.009Q320.103 147.009 323.549 145.568Q327.029 144.127 327.029 139.978Q327.029 136.955 324.92 135.232Q322.845 133.474 318.732 132.033Q314.654 130.591 308.291 128.587Q302.244 126.584 297.779 124.228Q293.314 121.837 290.853 118.111Q288.427 114.349 288.427 108.302Q288.427 98.9156 295.177 93.818Q301.963 88.7203 316.939 88.7203Q322.845 88.7203 328.154 89.5992Q333.498 90.443 337.26 91.7437L337.26 104.822Q333.217 103.24 328.4 102.396Q323.584 101.517 319.4 101.517Q311.912 101.517 308.08 102.818Q304.283 104.119 304.283 107.986Q304.283 112.029 308.22 113.681Q312.193 115.334 320.982 118.216Q329.033 120.677 333.779 123.42Q338.56 126.127 340.635 129.959Q342.709 133.791 342.709 139.837Q342.709 149.892 335.361 154.884Q328.049 159.841 314.056 159.841ZM390.525 159.841Q372.666 159.841 362.857 151.052Q353.083 142.263 353.083 124.123Q353.083 107.705 361.416 98.2125Q369.783 88.7203 386.798 88.7203Q402.337 88.7203 410.177 96.8414Q418.017 104.962 418.017 117.795L418.017 130.451L368.06 130.451Q369.22 140.4 375.267 144.162Q381.314 147.888 393.689 147.888Q398.892 147.888 404.341 146.904Q409.826 145.884 413.869 144.302L413.869 155.798Q409.263 157.837 403.287 158.822Q397.31 159.841 390.525 159.841ZM368.06 120.255L404.201 120.255L404.201 115.474Q404.201 108.443 400.298 104.47Q396.431 100.498 387.22 100.498Q376.287 100.498 372.173 105.279Q368.06 110.025 368.06 120.255ZM433.294 158.4L433.294 90.1266L447.708 90.1266L448.411 97.3336Q453.017 93.7477 459.415 91.2516Q465.849 88.7203 473.619 88.7203Q486.872 88.7203 492.919 94.9078Q498.966 101.095 498.966 114.209L498.966 158.4L483.392 158.4L483.392 114.912Q483.392 107.002 480.158 103.837Q476.923 100.673 467.994 100.673Q462.685 100.673 457.552 102.818Q452.454 104.962 449.009 108.443L449.009 158.4L433.294 158.4ZM539.272 159.841Q532.241 159.841 525.808 158.822Q519.409 157.837 515.226 156.396L515.226 143.142Q520.112 145.005 526.018 146.025Q531.925 147.009 537.268 147.009Q545.319 147.009 548.765 145.568Q552.245 144.127 552.245 139.978Q552.245 136.955 550.136 135.232Q548.061 133.474 543.948 132.033Q539.87 130.591 533.507 128.587Q527.46 126.584 522.995 124.228Q518.53 121.837 516.069 118.111Q513.643 114.349 513.643 108.302Q513.643 98.9156 520.393 93.818Q527.179 88.7203 542.155 88.7203Q548.061 88.7203 553.37 89.5992Q558.714 90.443 562.476 91.7437L562.476 104.822Q558.433 103.24 553.616 102.396Q548.8 101.517 544.616 101.517Q537.128 101.517 533.296 102.818Q529.499 104.119 529.499 107.986Q529.499 112.029 533.436 113.681Q537.409 115.334 546.198 118.216Q554.249 120.677 558.995 123.42Q563.776 126.127 565.851 129.959Q567.925 133.791 567.925 139.837Q567.925 149.892 560.577 154.884Q553.265 159.841 539.272 159.841ZM615.741 159.841Q597.882 159.841 588.073 151.052Q578.299 142.263 578.299 124.123Q578.299 107.705 586.632 98.2125Q594.999 88.7203 612.014 88.7203Q627.553 88.7203 635.393 96.8414Q643.233 104.962 643.233 117.795L643.233 130.451L593.276 130.451Q594.436 140.4 600.483 144.162Q606.53 147.888 618.905 147.888Q624.108 147.888 629.557 146.904Q635.042 145.884 639.085 144.302L639.085 155.798Q634.479 157.837 628.503 158.822Q622.526 159.841 615.741 159.841ZM593.276 120.255L629.417 120.255L629.417 115.474Q629.417 108.443 625.514 104.47Q621.647 100.498 612.436 100.498Q601.503 100.498 597.389 105.279Q593.276 110.025 593.276 120.255Z"
                                fill="#ffffff"
                            />
                            <g transform="translate(624 2)">
                                <path
                                    d="M0 0C43.9066 0 79.5 35.5934 79.5 79.5"
                                    fill="none"
                                    stroke-width="10"
                                    stroke="#3B9DDC"
                                    transform="translate(13.25 13.25)"
                                />
                                <path
                                    d="M0 0C29.2711 0 53 23.7289 53 53"
                                    fill="none"
                                    stroke-width="10"
                                    stroke="#3B9DDC"
                                    transform="translate(13.25 39.75)"
                                />
                                <path
                                    d="M0 0C14.6355 0 26.5 11.8645 26.5 26.5"
                                    fill="none"
                                    stroke-width="10"
                                    stroke="#3B9DDC"
                                    transform="translate(13.25 66.25)"
                                />
                            </g>
                        </g>
                    </svg>
                    <span id="nome_empresa"></span>
                </div>

                <!--Links container-->
                <div class="links-container">
                    <ul>
                        <!--Dashboard-->
                        <li onclick="redirecionar('dashboard.html')">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                height="24px"
                                viewBox="0 -960 960 960"
                                width="24px"
                                fill="#fff"
                            >
                                <path
                                    d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h240v-560H200v560Zm320 0h240v-280H520v280Zm0-360h240v-200H520v200Z"
                                />
                            </svg>
                            <span>Dashboard</span>
                        </li>

                        <!--Setores-->
                        <li onclick="redirecionar('setores.html')">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                height="24px"
                                viewBox="0 -960 960 960"
                                width="24px"
                                fill="#fff"
                            >
                                <path
                                    d="M220-80q-58 0-99-41t-41-99q0-58 41-99t99-41q18 0 35 4.5t32 12.5l153-153v-110q-44-13-72-49.5T340-740q0-58 41-99t99-41q58 0 99 41t41 99q0 48-28 84.5T520-606v110l154 153q15-8 31.5-12.5T740-360q58 0 99 41t41 99q0 58-41 99t-99 41q-58 0-99-41t-41-99q0-18 4.5-35t12.5-32L480-424 343-287q8 15 12.5 32t4.5 35q0 58-41 99t-99 41Zm520-80q25 0 42.5-17.5T800-220q0-25-17.5-42.5T740-280q-25 0-42.5 17.5T680-220q0 25 17.5 42.5T740-160ZM480-680q25 0 42.5-17.5T540-740q0-25-17.5-42.5T480-800q-25 0-42.5 17.5T420-740q0 25 17.5 42.5T480-680ZM220-160q25 0 42.5-17.5T280-220q0-25-17.5-42.5T220-280q-25 0-42.5 17.5T160-220q0 25 17.5 42.5T220-160Z"
                                />
                            </svg>
                            <span>Setores</span>
                        </li>

                        <!--Sensores-->
                        <li style="background-color: var(--color-bright-blue)">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                height="24px"
                                viewBox="0 -960 960 960"
                                width="24px"
                                fill="#fff"
                            >
                                <path
                                    d="M197-197q-54-55-85.5-127.5T80-480q0-84 31.5-156.5T197-763l57 57q-44 44-69 102t-25 124q0 67 25 125t69 101l-57 57Zm113-113q-32-33-51-76.5T240-480q0-51 19-94.5t51-75.5l57 57q-22 22-34.5 51T320-480q0 33 12.5 62t34.5 51l-57 57Zm170-90q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm170 90-57-57q22-22 34.5-51t12.5-62q0-33-12.5-62T593-593l57-57q32 32 51 75.5t19 94.5q0 50-19 93.5T650-310Zm113 113-57-57q44-44 69-102t25-124q0-67-25-125t-69-101l57-57q54 54 85.5 126.5T880-480q0 83-31.5 155.5T763-197Z"
                                />
                            </svg>
                            <span>Sensores</span>
                        </li>

                        <!--Alertas-->
                        <li onclick="redirecionar('alerts.html')">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                height="24px"
                                viewBox="0 -960 960 960"
                                width="24px"
                                fill="#fff"
                            >
                                <path
                                    d="M120-160v-80h480v80H120Zm520-280q-83 0-141.5-58.5T440-640q0-83 58.5-141.5T640-840q83 0 141.5 58.5T840-640q0 83-58.5 141.5T640-440Zm-520-40v-80h252q7 22 16 42t22 38H120Zm0 160v-80h376q23 14 49 23.5t55 13.5v43H120Zm500-280h40v-160h-40v160Zm20 80q8 0 14-6t6-14q0-8-6-14t-14-6q-8 0-14 6t-6 14q0 8 6 14t14 6Z"
                                />
                            </svg>
                            <span>Alertas</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!--Logout-->
            <div class="logout">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    height="24px"
                    viewBox="0 -960 960 960"
                    width="24px"
                    fill="#fff"
                >
                    <path
                        d="M234-276q51-39 114-61.5T480-360q69 0 132 22.5T726-276q35-41 54.5-93T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 59 19.5 111t54.5 93Zm246-164q-59 0-99.5-40.5T340-580q0-59 40.5-99.5T480-720q59 0 99.5 40.5T620-580q0 59-40.5 99.5T480-440Zm0 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q53 0 100-15.5t86-44.5q-39-29-86-44.5T480-280q-53 0-100 15.5T294-220q39 29 86 44.5T480-160Zm0-360q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm0-60Zm0 360Z"
                    />
                </svg>
                <span id="nome_usuario"></span>
                <button type="button" title="Sair" onclick="abrirModalLogout()">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        height="24px"
                        viewBox="0 -960 960 960"
                        width="24px"
                        fill="#fff"
                    >
                        <path
                            d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-160-55-58 102-102H360v-80h327L585-622l55-58 200 200-200 200Z"
                        />
                    </svg>
                </button>
            </div>
        </div>

        <!--Body-->
        <div class="body">
            <!--Title-->
            <div class="title">
                <h2>Sensores</h2>
            </div>

            <!--Container-->
            <div class="container">
                <div id="qtd_sensores">...</div>

                <div class="sensores-container" id="sensor-container"></div>
            </div>
        </div>

        <!--Modal de Logout-->
        <div class="modal-logout" id="modal-logout">
            <!--Container Modal-->
            <div class="container-modal">
                <div class="title-modal">
                    <h3>Você tem certeza?</h3>
                </div>

                <div class="alerta-message">
                    <p>Você deseja deslogar de sua conta?</p>
                </div>

                <!--Buttons-->
                <div class="buttons">
                    <button type="button" onclick="logout()" id="confirm">
                        Fazer logout
                    </button>
                    <button
                        type="button"
                        onclick="cancelarLogout()"
                        id="cancel"
                    >
                        Cancelar
                    </button>
                </div>
            </div>
        </div>

        <!--Modal Sensor-->
        <div class="modal-sensor" id="modal-sensor">
            <div class="modal-sensor-container">
                <main>
                    <div class="container">
                        <span class="titulo-dash" id="sensor_nome">...</span>
                        <div class="close-modal">
                            <button
                                style="display: none"
                                type="button"
                                onclick="
                                    window.location.href =
                                        'http://localhost:3000'
                                "
                            >
                                <?xml version="1.0" encoding="utf-8"?>
                                <svg
                                    width="25px"
                                    height="25px"
                                    viewBox="0 0 512 512"
                                    version="1.1"
                                    xmlns="http://www.w3.org/2000/svg"
                                >
                                    <title>support</title>
                                    <g
                                        id="Page-1"
                                        stroke="none"
                                        stroke-width="1"
                                        fill="none"
                                        fill-rule="evenodd"
                                    >
                                        <g
                                            id="support"
                                            fill="#000000"
                                            transform="translate(42.666667, 42.666667)"
                                        >
                                            <path
                                                d="M379.734355,174.506667 C373.121022,106.666667 333.014355,-2.13162821e-14 209.067688,-2.13162821e-14 C85.1210217,-2.13162821e-14 45.014355,106.666667 38.4010217,174.506667 C15.2012632,183.311569 -0.101643453,205.585799 0.000508304259,230.4 L0.000508304259,260.266667 C0.000508304259,293.256475 26.7445463,320 59.734355,320 C92.7241638,320 119.467688,293.256475 119.467688,260.266667 L119.467688,230.4 C119.360431,206.121456 104.619564,184.304973 82.134355,175.146667 C86.4010217,135.893333 107.307688,42.6666667 209.067688,42.6666667 C310.827688,42.6666667 331.521022,135.893333 335.787688,175.146667 C313.347976,184.324806 298.68156,206.155851 298.667688,230.4 L298.667688,260.266667 C298.760356,283.199651 311.928618,304.070103 332.587688,314.026667 C323.627688,330.88 300.801022,353.706667 244.694355,360.533333 C233.478863,343.50282 211.780225,336.789048 192.906491,344.509658 C174.032757,352.230268 163.260418,372.226826 167.196286,392.235189 C171.132153,412.243552 188.675885,426.666667 209.067688,426.666667 C225.181549,426.577424 239.870491,417.417465 247.041022,402.986667 C338.561022,392.533333 367.787688,345.386667 376.961022,317.653333 C401.778455,309.61433 418.468885,286.351502 418.134355,260.266667 L418.134355,230.4 C418.23702,205.585799 402.934114,183.311569 379.734355,174.506667 Z M76.8010217,260.266667 C76.8010217,269.692326 69.1600148,277.333333 59.734355,277.333333 C50.3086953,277.333333 42.6676884,269.692326 42.6676884,260.266667 L42.6676884,230.4 C42.6676884,224.302667 45.9205765,218.668499 51.2010216,215.619833 C56.4814667,212.571166 62.9872434,212.571166 68.2676885,215.619833 C73.5481336,218.668499 76.8010217,224.302667 76.8010217,230.4 L76.8010217,260.266667 Z M341.334355,230.4 C341.334355,220.97434 348.975362,213.333333 358.401022,213.333333 C367.826681,213.333333 375.467688,220.97434 375.467688,230.4 L375.467688,260.266667 C375.467688,269.692326 367.826681,277.333333 358.401022,277.333333 C348.975362,277.333333 341.334355,269.692326 341.334355,260.266667 L341.334355,230.4 Z"
                                                style="fill: rgb(255, 255, 255)"
                                            />
                                        </g>
                                    </g>
                                </svg>
                                <span>Obter suporte</span>
                            </button>
                            <button type="button" onclick="fecharModalSensor()">
                                Fechar
                            </button>
                        </div>

                        <div class="container-sensor">
                            <div class="container-graficos">
                                <div class="grafico-secundario" id="">
                                    <canvas id="chart1"></canvas>
                                </div>
                            </div>

                            <div class="cards-kpi">
                                <div class="card-individual">
                                    <span class="titulo-card">Maior pico</span>
                                    <span class="dado-kpi" id="horario"></span>
                                    <span class="legenda-kpi"
                                        >*Dados dos últimos 10 minutos</span
                                    >
                                </div>

                                <div class="card-individual">
                                    <span class="titulo-card"
                                        >Valor do pico</span
                                    >
                                    <span class="dado-kpi" id="percentual"></span>
                                    <span class="legenda-kpi"
                                        >*A partir de 2% passa a ser
                                        explosivo</span
                                    >
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!--ChartJS-->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script>

        <!--Sensores-->
        <script src="../assets/javascript/sensores.js"></script>

        <!--Graficos Murilo-->
        <script src="../assets/javascript/graficos-murilo.js"></script>

        <!--Redirect-->
        <script src="../assets/javascript/redirect.js"></script>

        <!--Sessão-->
        <script src="../assets/javascript/session.js"></script>

        <!--Logout-->
        <script src="../assets/javascript/logout.js"></script>

        <script>


            let proximaAtualizacao;

            let myChart;

<<<<<<< HEAD
            
            horario.innerHTML = '__:__:__';
            percentual.innerHTML = '_%';
                    
            var maior = {};

            // Aciona um evento carregar a página
            document.addEventListener("DOMContentLoaded", () => {
=======
            window.onload = function () {
>>>>>>> 785f12b7858b69ad24cc4ea54f5c7a97c744bdcc
                listarSensores();
            };

            nome_empresa.innerHTML = sessionStorage.NOME_EMPRESA.replaceAll(
                '"',
                "",
            );
            nome_usuario.innerHTML = sessionStorage.NOME_USUARIO.replaceAll(
                '"',
                "",
            );

            var modalLogout = document.getElementById("modal-logout");

            // Função para cancelar o Logout
            function cancelarLogout() {
                modalLogout.style.display = "none";
            }

            // Função para abrir o modal de logout
            function abrirModalLogout() {
                modalLogout.style.display = "flex";
            }

            // Função para abrir o modal de sensor
            function modalSensor(idSensor) {
                maior = {};
                document.getElementById("modal-sensor").style.display = "flex";
                window.scrollTo(0, 0);
                var tituloSensor = document.getElementById(
                    `sensor-${idSensor}`,
                ).innerHTML;
                document.getElementById("sensor_nome").innerHTML = tituloSensor;

                document.body.style.overflowY = "hidden";
                obterDadosGrafico(idSensor);
            }

            // Função para fechar o modal do grafico
            function fecharModalSensor() {
                document.getElementById("modal-sensor").style.display = "none";
                document.body.style.overflow = "auto";
                if (myChart) {
                    myChart.destroy();
                    horario.innerHTML = '__:__:__';
                    percentual.innerHTML = '_%';
                    maior = {};
                }
            }

            // Função para obter os dados do grafico
            function obterDadosGrafico(idSensor) {
                if (proximaAtualizacao != undefined) {
                    clearTimeout(proximaAtualizacao);
                }
                fetch(`/sensores/ultimas/${idSensor}`, { cache: "no-store" })
                    .then(function (response) {
                        if (response.ok) {
                            response.json().then(function (resposta) {
                                console.log(
                                    `Dados recebidos: ${JSON.stringify(resposta)}`,
                                );
                                resposta.reverse();

                                plotarGrafico(resposta, idSensor);
                            });
                        } else {
                            console.error(
                                "Nenhum dado encontrado ou erro na API",
                            );
                        }
                    })
                    .catch(function (error) {
                        console.error(
                            `Erro na obtenção dos dados p/ gráfico: ${error.message}`,
                        );
                    });
            }

            // Função para plotar o grafico
            function plotarGrafico(resposta, idSensor) {
                const canvas = document.getElementById("chart1");

                var resKPI = resposta;

                console.log("iniciando plotagem do gráfico...");
                // Criando estrutura para plotar gráfico - labels
                let labels = [];

                // Criando estrutura para plotar gráfico - dados
                let dados = {
                    labels: labels,
                    datasets: [
                        {
                            label: "Nível de concentração de GLP",
                            data: [],
                            backgroundColor: "rgb(59, 157, 220)",
                            borderWidth: 5,
                            borderColor: "rgb(59, 157, 220)",
                            font: {
                                family: "Kanit",
                            },
                            color: "rgb(10, 43, 64)",
                            tension: 0.2,
                        },
                    ],
                };

                console.log("----------------------------------------------");
                console.log(
                    'Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":',
                );
                console.log(resposta);
                

                // Inserindo valores recebidos em estrutura para plotar o gráfico
                for (i = 0; i < resposta.length; i++) {
                    var registro = resposta[i];
                    labels.push(registro.momento_grafico);
                    dados.datasets[0].data.push(registro.valor_medicao);
                    if(i == 0){
                        maior = registro;
                    }

                    if(registro.valor_medicao > maior.valor_medicao){
                        maior = registro;
                    }
                }

                horario.innerHTML = `${maior.momento_grafico}`;
                percentual.innerHTML - `${maior.valor_medicao}%`;

                console.log("----------------------------------------------");
                console.log(
                    "O gráfico será plotado com os respectivos valores:",
                );
                console.log("Labels:");
                console.log(labels);
                console.log("Dados:");
                console.log(dados.datasets);
                console.log("----------------------------------------------");

                const config = {
                    type: "line",
                    data: dados,
                    options: {
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: "Concentração de GLP (%)",
                                    font: {
                                        size: 12,
                                        weight: "600",
                                        family: "Kanit",
                                    },
                                    color: "rgb(10, 43, 64)",
                                    padding: { bottom: 8 },
                                },
                                beginAtZero: true,
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: "Horário da Medição",
                                    font: {
                                        size: 12,
                                        weight: "600",
                                        family: "Kanit",
                                    },
                                    padding: { top: 8 },
                                    color: "rgb(10, 43, 64)",
                                },
                                ticks: {
                                    font: {
                                        weight: "bold",
                                        family: "Kanit",
                                    },
                                    color: "rgb(10, 43, 64)",
                                },
                            },
                        },
                        plugins: {
                            annotation: {
                                drawtime: "afterdraw",
                                annotations: {
                                    linhaLimite: {
                                        type: "line",
                                        yMin: limiteExplosivo,
                                        yMax: limiteExplosivo,
                                        borderWidth: 3,
                                        borderColor: "#ff0000",
                                        borderDash: [8, 4],
                                        label: {
                                            display: false,
                                            content:
                                                "Valor limítrofe de explosividade (LEL)",
                                            position: "end",
                                            backgroundColor:
                                                "rgba(255,0,0,0.65)",
                                            color: "rgb(255, 255, 255)",
                                            padding: 16,
                                            margin: 5,
                                            font: {
                                                weight: "bold",
                                                family: "Kanit",
                                            },
                                        },
                                        enter: function (
                                            GraphMomentoSensor,
                                            event,
                                        ) {
                                            GraphMomentoSensor.element.label.options.display = true;
                                            GraphMomentoSensor.chart.draw(); //aparece a box na linha fixa
                                        },
                                        leave: function (
                                            GraphMomentoSensor,
                                            event,
                                        ) {
                                            GraphMomentoSensor.element.label.options.display = false;
                                            GraphMomentoSensor.chart.draw(); //some a box da linha fixa
                                        },
                                    },
                                },
                            },

                            legend: {
                                labels: {
                                    font: {},
                                },
                            },

                            title: {
                                display: true,
                                text: "Dados em tempo real",
                                position: "top",
                                align: "center",
                                font: {
                                    size: 20,
                                    family: "Kanit",
                                },
                                color: "rgb(10, 43, 64)",
                            },
                        },
                    },
                };

                // Adicionando gráfico criado em div na tela
                myChart = new Chart(canvas, config);

                setTimeout(
                    () => atualizarGrafico(idSensor, dados, myChart,maior),
                    2000,
                );
            }

            // Função para atualizar o grafico
            function atualizarGrafico(idSensor, dados, myChart,maior) {
                fetch(`/sensores/tempo-real/${idSensor}`, { cache: "no-store" })
                    .then(function (response) {
                        if (response.ok) {
                            response.json().then(function (novoRegistro) {
                                // obterDadosGrafico(idSensor);
                                // alertar(novoRegistro, idAquario);
                                console.log(
                                    `Dados recebidos: ${JSON.stringify(novoRegistro)}`,
                                );
                                console.log(`Dados atuais do gráfico:`);
                                console.log(dados);

                                console.log('Valor do Maior: '+maior.valor_medicao);

                                if(novoRegistro[novoRegistro.length-1].valor_medicao > maior.valor_medicao){

                                    maior = novoRegistro[novoRegistro.length-1];

                                }

                                console.log(novoRegistro[novoRegistro.length-1].valor_medicao);
                                console.log(novoRegistro[novoRegistro.length-1].momento_grafico);

                                horario.innerHTML = maior.momento_grafico;
                                percentual.innerHTML = maior.valor_medicao;

                                // let avisoCaptura = document.getElementById(
                                //     `avisoCaptura${idSensor}`,
                                // );
                                // avisoCaptura.innerHTML = "";

                                if (
                                    novoRegistro[0].momento_grafico ==
                                    dados.labels[dados.labels.length - 1]
                                ) {
                                    console.log(
                                        "---------------------------------------------------------------",
                                    );
                                    console.log(
                                        "Como não há dados novos para captura, o gráfico não atualizará.",
                                    );
                                    // avisoCaptura.innerHTML =
                                    //     "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará.";
                                    console.log(
                                        "Horário do novo dado capturado:",
                                    );
                                    console.log(
                                        novoRegistro[0].momento_grafico,
                                    );
                                    console.log(
                                        "Horário do último dado capturado:",
                                    );
                                    console.log(
                                        dados.labels[dados.labels.length - 1],
                                    );
                                    console.log(
                                        "---------------------------------------------------------------",
                                    );
                                } else {
                                    // tirando e colocando valores no gráfico
                                    dados.labels.shift(); // apagar o primeiro
                                    dados.labels.push(
                                        novoRegistro[0].momento_grafico,
                                    ); // incluir um novo momento

                                    dados.datasets[0].data.shift(); // apagar o primeiro de umde
                                    dados.datasets[0].data.push(
                                        novoRegistro[0].valor_medicao,
                                    ); // incluir uma nova medida de umidade

                                    myChart.update();
                                }

                                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                                proximaAtualizacao = setTimeout(
                                    () =>
                                        atualizarGrafico(
                                            idSensor,
                                            dados,
                                            myChart,
                                            maior
                                        ),
                                    2000,
                                );
                            });
                        } else {
                            console.error(
                                "Nenhum dado encontrado ou erro na API",
                            );
                            // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                            proximaAtualizacao = setTimeout(
                                () =>
                                    atualizarGrafico(idSensor, dados, myChart),
                                2000,
                            );
                        }
                    })
                    .catch(function (error) {
                        console.error(
                            `Erro na obtenção dos dados p/ gráfico: ${error.message}`,
                        );
                    });
            }
        </script>
    </body>
</html>
